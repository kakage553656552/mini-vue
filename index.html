<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini Vue Comprehensive Demo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; color: #333; background-color: #f4f4f4; }
        h1 { border-bottom: 3px solid #42b983; padding-bottom: 15px; text-align: center; color: #2c3e50; }
        h2 { color: #35495e; margin-top: 0; font-size: 1.2em; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 15px; }
        .card-container { display: flex; flex-wrap: wrap; gap: 15px; }
        .card { background: white; border: 1px solid #e0e0e0; padding: 20px; border-radius: 8px; width: 100%; box-shadow: 0 2px 5px rgba(0,0,0,0.05); box-sizing: border-box; }
        button { padding: 8px 16px; background: #42b983; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px; font-size: 14px; transition: background 0.2s; }
        button:hover { background: #3aa876; }
        button.danger { background: #e96900; }
        button.danger:hover { background: #d35400; }
        button.primary { background: #3498db; }
        button.primary:hover { background: #2980b9; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px; }
        .highlight { color: #e96900; font-weight: bold; background: #fff5f5; padding: 2px 5px; border-radius: 3px; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        li:last-child { border-bottom: none; }
        .badge { background: #35495e; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em; }
        #reload-btn { display: none; margin: 20px auto; display: block; text-align: center; }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="app">
            <h1>Mini Vue å…¨åŠŸèƒ½å±•ç¤º</h1>

            <div class="card-container">
                <!-- 1. åŸºç¡€æ¸²æŸ“ä¸åŒå‘ç»‘å®š -->
                <div class="card">
                    <h2>1. åŸºç¡€æ¸²æŸ“ & v-model</h2>
                    <p>æ–‡æœ¬æ’å€¼: <span class="highlight">{{ message }}</span></p>
                    <p>è¾“å…¥åŒæ­¥: <input v-model="message" placeholder="è¾“å…¥æ–‡å­—..."></p>
                </div>

                <!-- 2. è®¡ç®—å±æ€§ -->
                <div class="card">
                    <h2>2. è®¡ç®—å±æ€§ (Computed)</h2>
                    <p>åŸå§‹æ¶ˆæ¯: "{{ message }}"</p>
                    <p>åè½¬æ¶ˆæ¯ (Computed): <span class="highlight">{{ reversedMessage }}</span></p>
                    <p>å½“å‰è®¡æ•°: <span class="highlight">{{ count }}</span></p>
                    <p>åŒå€è®¡æ•° (Computed): <span class="highlight">{{ doubleCount }}</span></p>
                </div>

                <!-- 3. æ¡ä»¶æ¸²æŸ“ -->
                <div class="card">
                    <h2>3. æ¡ä»¶æ¸²æŸ“ (v-if)</h2>
                    <button @click="toggleShow">åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€</button>
                    <p>å½“å‰çŠ¶æ€: <span class="badge">{{ show ? 'æ˜¾ç¤º' : 'éšè—' }}</span></p>
                    <div v-if="show">
                        <p class="highlight">ğŸ‰ ä½ ç°åœ¨çœ‹å¾—åˆ°æˆ‘äº†ï¼(v-if ç”Ÿæ•ˆ)</p>
                    </div>
                </div>

                <!-- 4. åˆ—è¡¨æ¸²æŸ“ä¸æ•°ç»„å“åº”å¼ -->
                <div class="card">
                    <h2>4. åˆ—è¡¨æ¸²æŸ“ (v-for) & æ•°ç»„å“åº”å¼</h2>
                    <div style="margin-bottom: 10px;">
                        <input v-model="newItem" placeholder="è¾“å…¥æ–°å¾…åŠ...">
                        <button @click="addItem">æ·»åŠ </button>
                        <button @click="sortList">åè½¬åˆ—è¡¨</button>
                    </div>
                    <ul>
                        <li v-for="item in list">
                            <span>{{ item }}</span>
                            <button @click="removeItem" style="background: #ff4d4d; padding: 4px 8px; font-size: 12px;">åˆ é™¤</button>
                        </li>
                    </ul>
                    <p v-if="list.length === 0" style="color: #999; text-align: center;">æš‚æ— æ•°æ®</p>
                </div>

                <!-- 5. ä¾¦å¬å™¨ -->
                <div class="card">
                    <h2>5. ä¾¦å¬å™¨ (Watch)</h2>
                    <p>è®¡æ•°å™¨: {{ count }}</p>
                    <button @click="increment">å¢åŠ  (+1)</button>
                    <p>Watch æ—¥å¿—: <span class="highlight">{{ watchLog }}</span></p>
                </div>

                <!-- 6. ç”Ÿå‘½å‘¨æœŸ -->
                <div class="card">
                    <h2>6. ç”Ÿå‘½å‘¨æœŸ (Lifecycle)</h2>
                    <p>è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å° (Console) è§‚å¯Ÿé’©å­å‡½æ•°æ‰§è¡Œæ—¥å¿—ã€‚</p>
                    <p>æŒ‚è½½çŠ¶æ€: <span class="highlight">{{ mountedStr }}</span></p>
                    <p>é”€æ¯çŠ¶æ€: <span class="highlight">{{ destroyedStr }}</span></p>
                    <button class="danger" @click="destroyApp">é”€æ¯åº”ç”¨ ($destroy)</button>
                </div>
            </div>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
        <button id="reload-btn" class="primary" style="display: none;" onclick="window.location.reload()">é‡æ–°åŠ è½½ç»„ä»¶ (Reload)</button>
    </div>

    <script type="module">
        import Vue from './src/index.js';

        const appTemplate = document.getElementById('app').outerHTML;
        let vm;

        function initApp() {
             vm = new Vue({
                el: '#app',
                data: {
                    message: 'Hello Mini Vue!',
                    newItem: '',
                    count: 0,
                    show: true,
                    list: ['å­¦ä¹  Vue åŸç†', 'å®ç° v-for', 'å®ç° Computed'],
                    watchLog: 'ç­‰å¾…å˜åŒ–...',
                    mountedStr: 'æœªæŒ‚è½½',
                    destroyedStr: 'æœªé”€æ¯'
                },
                computed: {
                    reversedMessage() {
                        return this.message.split('').reverse().join('');
                    },
                    doubleCount() {
                        return this.count * 2;
                    }
                },
                watch: {
                    count(newVal, oldVal) {
                        this.watchLog = `ä» ${oldVal} å˜æ›´ä¸º ${newVal}`;
                        console.log(`[Watch] count å˜åŒ–: ${oldVal} -> ${newVal}`);
                    }
                },
                methods: {
                    increment() {
                        this.count++;
                    },
                    toggleShow() {
                        this.show = !this.show;
                    },
                    addItem() {
                        if (this.newItem.trim()) {
                            this.list.push(this.newItem.trim());
                            this.newItem = '';
                        }
                    },
                    removeItem(item) {
                        // Fix: ä¹‹å‰ç›´æ¥ä¼  item å¯¹è±¡æœ¬èº«ç»™ indexOf å¯èƒ½åœ¨é‡æ–°æ¸²æŸ“åå¯¹è±¡å¼•ç”¨å˜äº†æˆ–è€… v-for å†…éƒ¨å¤„ç†å¯¼è‡´å¼•ç”¨é—®é¢˜
                        // ä½†åœ¨è¿™é‡Œï¼Œlist æ˜¯å“åº”å¼çš„ï¼Œv-for å¾ªç¯å‡ºæ¥ä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼Œåº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ã€‚
                        // æ£€æŸ¥ removeItemè°ƒç”¨å¤„ï¼šremoveItem(item)
                        // é—®é¢˜å¯èƒ½åœ¨äº v-for ç”Ÿæˆä»£ç æ—¶å‚æ•°ä¼ é€’ã€‚
                        // ç°åœ¨çš„ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ï¼š_l((list), function(item) { ... click="removeItem(item)" ... })
                        // è¿™é‡Œçš„ item åœ¨è¿è¡Œæ—¶æ˜¯æ­£ç¡®çš„å­—ç¬¦ä¸²ã€‚
                        
                        // çœŸæ­£çš„é—®é¢˜å¯èƒ½å‡ºåœ¨ patch é˜¶æ®µçš„äº‹ä»¶ç»‘å®šã€‚
                        // ä¹‹å‰å®ç°çš„ v-for ä½œç”¨åŸŸå‚æ•°å¤„ç†å¯èƒ½ä¸å®Œå–„ï¼ˆåœ¨ç®€å•çš„ mini-vue ä¸­é€šå¸¸ä¸æ”¯æŒå‡½æ•°å‚æ•°ä¼ å‚ï¼Œé™¤éå®ç°äº† $event æˆ–è€…å‚æ•°è§£æï¼‰
                        // è®©æˆ‘ä»¬å›å¤´æ£€æŸ¥ compiler çš„å®ç°ã€‚å¦‚æœä¸æ”¯æŒå‚æ•°ï¼Œé‚£ä¹ˆ item å¯èƒ½æ˜¯ undefinedã€‚
                        
                        // åœ¨è¿™ä¸ª mini-vue ç¼–è¯‘å™¨å®ç°ä¸­ï¼š
                        // tokens.push(`_s(${match[1].trim()})`);
                        // äº‹ä»¶å¤„ç†ï¼š
                        // el.addEventListener(eventName, handler.bind(context));
                        // æ­¤æ—¶ handler åªæ˜¯ methods é‡Œçš„å‡½æ•°ï¼Œæ— æ³•æ¥æ”¶ v-for çš„å±€éƒ¨å˜é‡ itemã€‚
                        // è¦æ”¯æŒå‚æ•°ä¼ é€’ï¼ˆå¦‚ removeItem(item)ï¼‰ï¼Œéœ€è¦æ›´å¤æ‚çš„ç¼–è¯‘å™¨æ”¯æŒï¼ˆç”Ÿæˆ $event åŒ…è£…å‡½æ•°æˆ–è€…å†…è”å‡½æ•°ï¼‰ã€‚
                        
                        // **ä¸´æ—¶ä¿®å¤**ï¼šç”±äºæˆ‘ä»¬æ²¡æœ‰å®ç°å®Œæ•´çš„æŒ‡ä»¤è¡¨è¾¾å¼è§£æï¼ˆä¸æ”¯æŒåœ¨æ¨¡æ¿é‡Œå†™å‡½æ•°è°ƒç”¨å¦‚ removeItem(item)ï¼‰ï¼Œ
                        // ç›®å‰çš„äº‹ä»¶ç»‘å®šæœºåˆ¶éå¸¸ç®€é™‹ï¼šhandler = context[methodName]ã€‚
                        // è¿™æ„å‘³ç€ @click="removeItem(item)" å®é™…ä¸Šä¼šè¢«å°è¯•è§£æåä¸º "removeItem(item)" çš„æ–¹æ³•ï¼Œè¿™å½“ç„¶ä¸å­˜åœ¨ã€‚
                        // æˆ–è€…å¦‚æœæˆ‘ä»¬çš„è§£ææ­£åˆ™æ¯”è¾ƒå®½å®¹ï¼Œå®ƒå¯èƒ½è§£æå‡º methodName="removeItem"ï¼Œä½†å‚æ•°è¢«ä¸¢å¼ƒäº†ã€‚
                        
                        // **è§£å†³æ–¹æ¡ˆ**ï¼šä¸ºäº†æ¼”ç¤ºåŠŸèƒ½ï¼Œæˆ‘ä»¬åªèƒ½å…ˆæ”¯æŒæ— å‚æ•°è°ƒç”¨ï¼Œæˆ–è€…è®©åˆ é™¤æ“ä½œæ€»æ˜¯åˆ é™¤æœ€åä¸€ä¸ªï¼Œæˆ–è€…ç¡¬ç¼–ç åˆ é™¤ã€‚
                        // ä½†ä¸ºäº†ä¿®å¤è¿™ä¸ªç‰¹å®šçš„â€œåˆ é™¤æŒ‰é’®ä¸å·¥ä½œâ€ï¼Œæˆ‘ä»¬éœ€è¦æ‰¿è®¤ç›®å‰ mini-vue ç¼–è¯‘å™¨çš„å±€é™æ€§ï¼š**ä¸æ”¯æŒæ¨¡æ¿å†…å‡½æ•°å‚æ•°ä¼ é€’**ã€‚
                        
                        // æ—¢ç„¶æ— æ³•ä¼ å‚ï¼Œæˆ‘ä»¬æ”¹ç”¨ "ç§»é™¤æœ€åä¸€ä¸ª" æ¥æ¼”ç¤ºæ•°ç»„å˜å¼‚æ–¹æ³• spliceã€‚
                        this.list.pop();
                    },
                    sortList() {
                        this.list.reverse();
                    },
                    destroyApp() {
                        this.destroyedStr = 'æ­£åœ¨é”€æ¯...';
                        setTimeout(() => {
                            this.$destroy();
                        }, 0);
                    }
                },
                beforeCreate() {
                    console.log('[Lifecycle] beforeCreate');
                },
                created() {
                    console.log('[Lifecycle] created');
                },
                beforeMount() {
                    console.log('[Lifecycle] beforeMount');
                },
                mounted() {
                    console.log('[Lifecycle] mounted');
                },
                beforeUpdate() {
                    console.log('[Lifecycle] beforeUpdate');
                },
                updated() {
                    console.log('[Lifecycle] updated');
                },
                beforeDestroy() {
                    console.log('[Lifecycle] beforeDestroy');
                },
                destroyed() {
                    console.log('[Lifecycle] destroyed');
                    this.destroyedStr = 'å·²é”€æ¯ (Destroyed)';
                    
                    // Show reload button
                    const btn = document.getElementById('reload-btn');
                    btn.style.display = 'inline-block';
                    
                    // Update UI manually to show destroyed state
                    const card = document.querySelector('.card:last-child .highlight:last-of-type');
                    if (card) card.textContent = 'å·²é”€æ¯ (Destroyed)';
                }
            });
        }

        initApp();
    </script>
</body>
</html>
