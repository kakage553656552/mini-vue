<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini Vue Complete Demo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; color: #333; background-color: #f4f4f4; }
        h1 { border-bottom: 3px solid #42b983; padding-bottom: 15px; text-align: center; color: #2c3e50; }
        h2 { color: #35495e; margin-top: 0; font-size: 1.2em; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 15px; }
        .card-container { display: flex; flex-wrap: wrap; gap: 15px; }
        .card { background: white; border: 1px solid #e0e0e0; padding: 20px; border-radius: 8px; width: 100%; box-shadow: 0 2px 5px rgba(0,0,0,0.05); box-sizing: border-box; }
        button { padding: 8px 16px; background: #42b983; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px; font-size: 14px; transition: background 0.2s; }
        button:hover { background: #3aa876; }
        button.danger { background: #e96900; }
        button.danger:hover { background: #d35400; }
        button.primary { background: #3498db; }
        button.primary:hover { background: #2980b9; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 200px; }
        .highlight { color: #e96900; font-weight: bold; background: #fff5f5; padding: 2px 5px; border-radius: 3px; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 8px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        li:last-child { border-bottom: none; }
        .badge { background: #35495e; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em; }
        .panel { border: 1px dashed #ccc; padding: 8px; border-radius: 6px; margin-bottom: 8px; background: #fafafa; }
        .fade-enter { opacity: 0; }
        .fade-enter-active { transition: opacity 0.3s; }
        .fade-enter-to { opacity: 1; }
        .fade-leave { opacity: 1; }
        .fade-leave-active { transition: opacity 0.3s; }
        .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>
    <div id="app">
        <h1>ğŸ‰ Mini Vue å®Œæ•´åŠŸèƒ½å±•ç¤º</h1>

        <div class="card-container">
            <div class="card">
                <h2>1. åŸºç¡€æ¸²æŸ“ & v-model</h2>
                <p>æ–‡æœ¬æ’å€¼: <span class="highlight">{{ message }}</span></p>
                <p>è¾“å…¥åŒæ­¥: <input v-model="message" placeholder="è¾“å…¥æ–‡å­—..."></p>
            </div>

            <div class="card">
                <h2>2. è®¡ç®—å±æ€§ (Computed)</h2>
                <p>åŸå§‹æ¶ˆæ¯: "{{ message }}"</p>
                <p>åè½¬æ¶ˆæ¯: <span class="highlight">{{ reversedMessage }}</span></p>
                <p>å½“å‰è®¡æ•°: <span class="highlight">{{ count }}</span></p>
                <p>åŒå€è®¡æ•°: <span class="highlight">{{ doubleCount }}</span></p>
            </div>

            <div class="card">
                <h2>3. æ¡ä»¶æ¸²æŸ“ (v-if / v-else-if / v-else)</h2>
                <button @click="changeStatus">åˆ‡æ¢çŠ¶æ€ ({{ status }})</button>
                <div v-if="status === 'success'" style="color: green;">
                    âœ… æˆåŠŸçŠ¶æ€
                </div>
                <div v-else-if="status === 'warning'" style="color: orange;">
                    âš ï¸ è­¦å‘ŠçŠ¶æ€
                </div>
                <div v-else style="color: red;">
                    âŒ é”™è¯¯çŠ¶æ€
                </div>
            </div>

            <div class="card">
                <h2>4. v-show æŒ‡ä»¤</h2>
                <button @click="toggleVisible">åˆ‡æ¢å¯è§æ€§</button>
                <p v-show="visible" class="highlight">è¿™æ®µæ–‡å­—é€šè¿‡ v-show æ§åˆ¶æ˜¾ç¤º/éšè—</p>
            </div>

            <div class="card">
                <h2>5. åˆ—è¡¨æ¸²æŸ“ (v-for) & æ•°ç»„å“åº”å¼</h2>
                <div style="margin-bottom: 10px;">
                    <input v-model="newItem" placeholder="è¾“å…¥æ–°å¾…åŠ..." @keyup.enter="addItem">
                    <button @click="addItem">æ·»åŠ </button>
                    <button @click="sortList">åè½¬åˆ—è¡¨</button>
                </div>
                <ul>
                    <li v-for="item in list">
                        <span>{{ item }}</span>
                        <button @click="removeItem(item)" style="background: #ff4d4d; padding: 4px 8px; font-size: 12px;">åˆ é™¤</button>
                    </li>
                </ul>
                <p v-if="list.length === 0" style="color: #999; text-align: center;">æš‚æ— æ•°æ®</p>
            </div>

            <div class="card">
                <h2>6. åŠ¨æ€ç»‘å®š (v-bind / :)</h2>
                <div style="margin-bottom: 10px;">
                    <button @click="changePlaceholder">ä¿®æ”¹å ä½ç¬¦</button>
                    <button @click="toggleHighlight">åˆ‡æ¢æ ·å¼</button>
                </div>
                <input :placeholder="dynamicPlaceholder" v-model="input1">
                <p>åŠ¨æ€ class: <span :class="dynamicClass">æˆ‘çš„é¢œè‰²ä¼šå˜</span></p>
            </div>

            <div class="card">
                <h2>7. äº‹ä»¶ä¿®é¥°ç¬¦</h2>
                
                <!-- å†’æ³¡å¯¹æ¯” -->
                <div style="border: 1px dashed #ccc; padding: 10px; margin-bottom: 10px;" @click="handleOuterClick">
                    <p style="margin: 0 0 5px 0; font-size: 0.9em; color: #666;">å¤–å±‚å®¹å™¨ (ç‚¹å‡»ä¼šè§¦å‘ log)</p>
                    <button @click="handleClick">æ™®é€šæŒ‰é’® (å†’æ³¡)</button>
                    <button @click.stop="handleClick">Stop æŒ‰é’® (ä¸å†’æ³¡)</button>
                </div>

                <!-- é»˜è®¤è¡Œä¸ºå¯¹æ¯” -->
                <div style="border: 1px dashed #ccc; padding: 10px;">
                    <p style="margin: 0 0 5px 0; font-size: 0.9em; color: #666;">é»˜è®¤è¡Œä¸ºå¯¹æ¯”</p>
                    <a href="https://cn.vuejs.org" target="_blank" style="margin-right: 10px;">æ™®é€šé“¾æ¥ (è·³è½¬)</a>
                    <a href="https://cn.vuejs.org" @click.prevent="handleLinkClick" style="color: red;">Prevent é“¾æ¥ (ä¸è·³è½¬)</a>
                    
                    <form @submit.prevent="handleSubmit" style="margin-top: 10px;">
                        <input type="text" placeholder="æŒ‰å›è½¦æäº¤ (Prevent)">
                        <button type="submit">æäº¤</button>
                    </form>
                </div>
                
                <p>çŠ¶æ€æ—¥å¿—: <span class="highlight">{{ submitMsg }}</span></p>
            </div>

            <div class="card">
                <h2>8. $refs å¼•ç”¨</h2>
                <input ref="myInput" type="text" placeholder="é€šè¿‡ $refs æ“ä½œæˆ‘">
                <button @click="focusInput">èšç„¦è¾“å…¥æ¡†</button>
            </div>

            <div class="card">
                <h2>9. $emit è‡ªå®šä¹‰äº‹ä»¶</h2>
                <button @click="emitCustomEvent">è§¦å‘è‡ªå®šä¹‰äº‹ä»¶</button>
                <p>äº‹ä»¶è§¦å‘æ¬¡æ•°: {{ customEventCount }}</p>
            </div>

            <div class="card">
                <h2>10. Watch ä¾¦å¬å™¨</h2>
                <p>è®¡æ•°å™¨: {{ count }}</p>
                <button @click="increment">å¢åŠ  (+1)</button>
                <p>Watch æ—¥å¿—: <span class="highlight">{{ watchLog }}</span></p>
            </div>

            <div class="card">
                <h2>11. ç”Ÿå‘½å‘¨æœŸé’©å­</h2>
                <p>è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å° (Console) è§‚å¯Ÿé’©å­å‡½æ•°æ‰§è¡Œæ—¥å¿—ã€‚</p>
                <p>æŒ‚è½½çŠ¶æ€: <span class="highlight">å·²æŒ‚è½½ (Mounted)</span></p>
                <p>é”€æ¯çŠ¶æ€: <span class="highlight">{{ destroyedStr }}</span></p>
                <button class="danger" @click="destroyApp">é”€æ¯åº”ç”¨ ($destroy)</button>
            </div>

            <div class="card">
                <h2>12. ç»„ä»¶é€šä¿¡ (props/emit)</h2>
                <child-counter label="çˆ¶ä¼ å­è®¡æ•°" @update="childCount=$event"></child-counter>
                <p>çˆ¶ç»„ä»¶åŒæ­¥è®¡æ•°: <span class="highlight">{{ childCount }}</span></p>
            </div>

            <div class="card">
                <h2>13. æ’æ§½ (é»˜è®¤/å…·å)</h2>
                <slot-panel>
                    <div slot="header" class="highlight">å…·å header æ’æ§½</div>
                    <div>é»˜è®¤æ’æ§½å†…å®¹: {{ message }}</div>
                    <div slot="footer">é¡µè„šæ’æ§½: {{ footerText }}</div>
                </slot-panel>
            </div>

            <div class="card">
                <h2>14. keep-alive ç¼“å­˜</h2>
                <div style="margin-bottom:8px;">
                    <button @click="activeTab='tab-a'">åˆ‡æ¢ Tab A</button>
                    <button @click="activeTab='tab-b'">åˆ‡æ¢ Tab B</button>
                </div>
                <keep-alive>
                    <component :is="activeTab"></component>
                </keep-alive>
            </div>

            <div class="card">
                <h2>15. provide / inject</h2>
                <div style="margin-bottom:8px;">
                    <input v-model="themeValue" placeholder="è¾“å…¥ä¸»é¢˜å">
                    <button @click="bumpTheme">æ›´æ–°ä¸»é¢˜åºå·</button>
                </div>
                <provide-child></provide-child>
            </div>

            <div class="card">
                <h2>16. è‡ªå®šä¹‰æŒ‡ä»¤é’©å­</h2>
                <input v-model="directiveText" placeholder="è¾“å…¥æ–‡æœ¬" style="margin-bottom:8px;">
                <input v-highlight="directiveText" placeholder="æŒ‡ä»¤é«˜äº®è¾“å…¥æ¡†">
            </div>

            <div class="card">
                <h2>17. è¿‡æ¸¡åŠ¨ç”»</h2>
                <button @click="showTrans=!showTrans">åˆ‡æ¢æ˜¾ç¤º</button>
                <transition name="fade">
                    <p v-if="showTrans" class="highlight">å¸¦è¿‡æ¸¡çš„æ–‡æœ¬å—</p>
                </transition>
            </div>

            <div class="card">
                <h2>18. é”™è¯¯æ•è· (errorCaptured)</h2>
                <p>æ•è·ä¿¡æ¯: <span class="highlight">{{ errorMsg }}</span></p>
                <error-boundary @caught="onErrorCaught"></error-boundary>
            </div>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
        <button id="reload-btn" class="primary" style="display: none;" onclick="window.location.reload()">é‡æ–°åŠ è½½ç»„ä»¶ (Reload)</button>
    </div>

    <script type="module">
        import Vue from './src/index.js?v=2';

        const ChildCounter = {
            props: ['label'],
            data() {
                return { n: 0 };
            },
            methods: {
                inc() {
                    this.n++;
                    this.$emit('update', this.n);
                }
            },
            template: `
              <div>
                <p>{{ label }}ï¼š<span class="highlight">{{ n }}</span></p>
                <button @click="inc">å­ç»„ä»¶è‡ªå¢</button>
              </div>
            `
        };

        const SlotPanel = {
            template: `
              <div class="panel">
                <div><slot name="header"></slot></div>
                <div><slot></slot></div>
                <div><slot name="footer"></slot></div>
              </div>
            `
        };

        const TabA = {
            data() {
                return { count: 0 };
            },
            template: `<div class="panel">Tab A æ¬¡æ•°ï¼š<span class="highlight">{{ count }}</span> <button @click="count++">+1</button></div>`
        };

        const TabB = {
            data() {
                return { count: 0 };
            },
            template: `<div class="panel">Tab B æ¬¡æ•°ï¼š<span class="highlight">{{ count }}</span> <button @click="count++">+1</button></div>`
        };

        const ProvideChild = {
            inject: ['theme', 'themeSeq'],
            template: `<div class="panel">æ³¨å…¥ä¸»é¢˜ï¼š<span class="highlight">{{ theme }}</span> (#{{ themeSeq }})</div>`
        };

        const ErrorThrower = {
            template: `<button class="danger" @click="boom">æŠ›å‡ºé”™è¯¯</button>`,
            methods: {
                boom() {
                    throw new Error('å­ç»„ä»¶é”™è¯¯ç¤ºä¾‹');
                }
            }
        };

        const ErrorBoundary = {
            components: { ErrorThrower },
            data() {
                return { localError: '' };
            },
            errorCaptured(err) {
                this.localError = err.message;
                this.$emit('caught', err.message);
                return false;
            },
            template: `
              <div class="panel">
                <p>æœ¬åœ°æ•è·ï¼š<span class="highlight">{{ localError || 'æ— ' }}</span></p>
                <error-thrower></error-thrower>
              </div>
            `
        };

        Vue.directive('highlight', {
            bind(el, binding) {
                el.style.background = '#fffae6';
                el.value = binding.value || '';
            },
            update(el, binding) {
                el.style.background = '#fffae6';
                el.value = binding.value || '';
            },
            unbind(el) {
                el.style.background = '';
            }
        });

        Vue.component('child-counter', ChildCounter);
        Vue.component('slot-panel', SlotPanel);
        Vue.component('tab-a', TabA);
        Vue.component('tab-b', TabB);
        Vue.component('provide-child', ProvideChild);
        Vue.component('error-boundary', ErrorBoundary);

        const vm = new Vue({
            el: '#app',
            data: {
                message: 'Hello Mini Vue!',
                newItem: '',
                count: 0,
                status: 'success',
                visible: true,
                list: ['å­¦ä¹  Vue åŸç†', 'å®ç° v-for', 'å®ç° Computed'],
                watchLog: 'ç­‰å¾…å˜åŒ–...',
                destroyedStr: 'æœªé”€æ¯',
                dynamicPlaceholder: 'è¿™æ˜¯åŠ¨æ€å ä½ç¬¦',
                input1: '',
                dynamicClass: 'highlight',
                submitMsg: '',
                customEventCount: 0,
                childCount: 0,
                footerText: 'é¡µè„šå†…å®¹',
                activeTab: 'tab-a',
                themeValue: 'é»˜è®¤ä¸»é¢˜',
                themeSeq: 1,
                directiveText: '',
                showTrans: true,
                errorMsg: ''
            },
            computed: {
                reversedMessage() {
                    return this.message.split('').reverse().join('');
                },
                doubleCount() {
                    return this.count * 2;
                }
            },
            watch: {
                count(newVal, oldVal) {
                    this.watchLog = `ä» ${oldVal} å˜æ›´ä¸º ${newVal}`;
                    console.log(`[Watch] count å˜åŒ–: ${oldVal} -> ${newVal}`);
                },
                themeValue(newVal) {
                    this.syncProvide('theme', newVal);
                },
                themeSeq(newVal) {
                    this.syncProvide('themeSeq', newVal);
                }
            },
            methods: {
                increment() {
                    this.count++;
                },
                changeStatus() {
                    const statuses = ['success', 'warning', 'error'];
                    const current = statuses.indexOf(this.status);
                    this.status = statuses[(current + 1) % 3];
                },
                changePlaceholder() {
                    this.dynamicPlaceholder = 'æ—¶é—´æˆ³: ' + new Date().toLocaleTimeString();
                },
                toggleHighlight() {
                    this.dynamicClass = this.dynamicClass === 'highlight' ? '' : 'highlight';
                },
                toggleVisible() {
                    this.visible = !this.visible;
                    console.log('toggleVisible', this.visible);
                },
                addItem() {
                    if (this.newItem.trim()) {
                        this.list.push(this.newItem.trim());
                        this.newItem = '';
                    }
                },
                removeItem(item) {
                    const index = this.list.indexOf(item);
                    if (index > -1) {
                        this.list.splice(index, 1);
                    }
                },
                sortList() {
                    this.list.reverse();
                },
                handleOuterClick() {
                    this.submitMsg = 'å¤–å±‚å®¹å™¨è¢«ç‚¹å‡» (å†’æ³¡å‘ç”Ÿ)';
                    console.log('[Event] å¤–å±‚å®¹å™¨è¢«ç‚¹å‡»');
                },
                handleClick() {
                    this.submitMsg = 'æŒ‰é’®è¢«ç‚¹å‡»';
                    console.log('[Event] æŒ‰é’®è¢«ç‚¹å‡»');
                },
                handleLinkClick() {
                    this.submitMsg = 'é“¾æ¥ç‚¹å‡»è¢«æ‹¦æˆª (Prevent ç”Ÿæ•ˆ)';
                    console.log('[Event] é“¾æ¥ç‚¹å‡»è¢«æ‹¦æˆª');
                },
                handleSubmit() {
                    this.submitMsg = 'è¡¨å•å·²æäº¤ï¼Œé¡µé¢æ²¡æœ‰åˆ·æ–°ï¼';
                    console.log('[Event] è¡¨å•æäº¤ï¼Œå·²é˜»æ­¢é»˜è®¤è¡Œä¸º');
                },
                focusInput() {
                    if (this.$refs.myInput) {
                        this.$refs.myInput.focus();
                    }
                },
                emitCustomEvent() {
                    this.$emit('custom-event', { data: 'some data' });
                },
                destroyApp() {
                    this.destroyedStr = 'æ­£åœ¨é”€æ¯...';
                    setTimeout(() => {
                        this.$destroy();
                    }, 0);
                },
                bumpTheme() {
                    this.themeSeq++;
                },
                onErrorCaught(msg) {
                    this.errorMsg = msg;
                },
                syncProvide(key, val) {
                    if (!this._provided) this._provided = {};
                    this._provided[key] = val;
                    if (this.$children && this.$children.length) {
                        this.$children.forEach(c => {
                            if (c.$options && c.$options.inject) {
                                c.$forceUpdate && c.$forceUpdate();
                            }
                        });
                    }
                }
            },
            beforeCreate() {
                console.log('[Lifecycle] beforeCreate');
            },
            created() {
                console.log('[Lifecycle] created');
                this.$on('custom-event', (payload) => {
                    this.customEventCount++;
                    console.log('[Custom Event] æ¥æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶:', payload);
                });
            },
            beforeMount() {
                console.log('[Lifecycle] beforeMount');
            },
            mounted() {
                console.log('[Lifecycle] mounted');
            },
            // beforeUpdate() {
            //     console.log('[Lifecycle] beforeUpdate');
            // },
            // updated() {
            //     console.log('[Lifecycle] updated');
            // },
            beforeDestroy() {
                console.log('[Lifecycle] beforeDestroy');
            },
            destroyed() {
                console.log('[Lifecycle] destroyed');
                this.destroyedStr = 'å·²é”€æ¯ (Destroyed)';
                
                const btn = document.getElementById('reload-btn');
                btn.style.display = 'inline-block';
                
                const card = document.querySelector('.card:last-child .highlight:last-of-type');
                if (card) card.textContent = 'å·²é”€æ¯ (Destroyed)';
            },
            provide() {
                return {
                    theme: this.themeValue,
                    themeSeq: this.themeSeq
                };
            }
        });
    </script>
</body>
</html>
